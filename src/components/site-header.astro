---
import Logo from "@/assets/icon.svg";
import Container from "@/components/container.astro";
import { siteConfig } from "@/lib/site-config";
import { getChromeStoreUrl } from "@/utils/chrome-store-url";
import { removeTrailingSlash } from "@/utils/url";
import { Icon } from "astro-icon/components";

const currentPath = removeTrailingSlash(Astro.url.pathname);

const navLinks = [
  { label: "How it works", href: "/#how-it-works" },
  { label: "Features", href: "/#features" },
  { label: "Use cases", href: "/#use-cases" },
  { label: "Pricing", href: "/#pricing" },
];
---

<a
  href="#main-content"
  class="absolute -top-10 left-0 z-50 rounded-br-lg bg-white px-4 py-2 font-medium text-emerald-950 no-underline focus:top-0 dark:bg-emerald-400 dark:text-emerald-950"
>
  Skip to main content
</a>

<header
  class="sticky top-0 z-40 bg-linear-to-r from-emerald-950 via-emerald-900 to-emerald-950 shadow-lg shadow-emerald-950/20"
>
  <!-- Subtle gradient overlay for depth -->
  <div
    class="pointer-events-none absolute inset-0 bg-linear-to-b from-white/5 to-transparent"
    aria-hidden="true"
  >
  </div>

  <Container>
    <nav
      aria-label="Main navigation"
      class="relative flex h-header items-center justify-between"
    >
      <a
        href="/"
        class="flex items-center gap-2.5 rounded-lg font-semibold text-white no-underline transition-opacity hover:opacity-90"
      >
        <Logo width={36} height={36} class="size-9 drop-shadow-md" />
        <span class="text-lg tracking-tight">{siteConfig.name}</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-6 md:flex">
        <ul class="flex list-none items-center gap-6">
          {
            navLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  aria-current={currentPath === link.href ? "page" : undefined}
                  class="whitespace-nowrap rounded-md px-2 py-1 text-sm font-medium text-emerald-100/90 transition-colors hover:text-white aria-[current=page]:text-white aria-[current=page]:underline aria-[current=page]:underline-offset-4"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
        <a
          href={getChromeStoreUrl("header")}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex shrink-0 items-center gap-2 whitespace-nowrap rounded-lg bg-white px-4 py-2 text-sm font-semibold text-emerald-900 shadow-md transition-all hover:bg-emerald-50 hover:shadow-lg"
        >
          <Icon
            name="simple-icons:googlechrome"
            class="size-4"
            aria-hidden="true"
          />
          Add to Chrome
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        type="button"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="group flex size-10 cursor-pointer items-center justify-center rounded-lg text-emerald-100/90 transition-colors hover:bg-white/10 hover:text-white md:hidden"
        id="menu-button"
      >
        <Icon
          name="lucide:menu"
          class="size-6 group-aria-expanded:hidden"
          aria-hidden="true"
        />
        <Icon
          name="lucide:x"
          class="hidden size-6 group-aria-expanded:block"
          aria-hidden="true"
        />
      </button>
    </nav>
  </Container>

  <!-- Mobile Navigation (overlay) -->
  <div
    id="mobile-menu"
    class="absolute inset-x-0 top-header bg-linear-to-r from-emerald-950 via-emerald-900 to-emerald-950 shadow-lg shadow-emerald-950/20 duration-200 md:hidden aria-hidden:pointer-events-none aria-hidden:invisible aria-hidden:animate-out aria-hidden:fade-out aria-hidden:slide-out-to-top-2 aria-[hidden=false]:visible aria-[hidden=false]:animate-in aria-[hidden=false]:fade-in aria-[hidden=false]:slide-in-from-top-2"
    aria-hidden="true"
  >
    <div class="mx-auto w-full max-w-7xl px-4">
      <ul class="flex list-none flex-col gap-2 py-4">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                aria-current={currentPath === link.href ? "page" : undefined}
                class="block rounded-lg px-4 py-2.5 text-sm font-medium text-emerald-100/90 transition-colors hover:bg-white/10 hover:text-white aria-[current=page]:bg-white/10 aria-[current=page]:text-white"
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</header>

<script>
  const menuButton = document.getElementById("menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileNavLinks = mobileMenu?.querySelectorAll("a");

  function closeMenu() {
    menuButton?.setAttribute("aria-expanded", "false");
    mobileMenu?.setAttribute("aria-hidden", "true");
  }

  function openMenu() {
    menuButton?.setAttribute("aria-expanded", "true");
    mobileMenu?.setAttribute("aria-hidden", "false");
  }

  menuButton?.addEventListener("click", () => {
    const isExpanded = menuButton.getAttribute("aria-expanded") === "true";
    if (isExpanded) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  mobileNavLinks?.forEach((link) => {
    link.addEventListener("click", closeMenu);
  });
</script>
